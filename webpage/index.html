<!DOCTYPE html>
<html>
	<head>
	<meta name="robots" content="noindex" />
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
	<title>Snow and Ice Data</title>
	<script type="text/javascript" src="jquery.js"></script>		
		
	<style type="text/css">
		a:visited, a:link{
			color: #909090;
			text-decoration: none;
		}
		.header {
			clear: both;
			margin-left: auto;
			margin-top: 30px;
			margin-bottom: 20px;
			margin-right: auto;
			width: 1200px;
			height: 50px;
			text-align: center;
			font-size: 36px;
			font-weight: 300;
			text-shadow: 0 1px 0 #fff;
		}
		.subtitle {
			color: rgb(153, 153, 153); 
			font-size: 12px;
		}
		.menu{
			clear: both;
			margin-left: auto;
			margin-right: auto;
			width: 1200px;
			height: 10px;
			margin-bottom: -5px;
		}
		.menu #sparkInterface { color: #aaa; }
		#outputImageTemperature { float: left; width: 300px; height: 30px; text-align: left; margin-left: 10px; }
		#outputImageCoordinates { float: left; width: 200px; height: 30px; text-align: left; }
		#outputImageMin { float: left; width: 150px; height: 30px; text-align: left; }
		#outputImageMax { float: left; width: 120px; height: 30px; text-align: left; }
		.block {
			clear: both;
			margin-left: auto;
			margin-right: auto;
			width: 1200px;
			height: 650px;
			margin-top: 20px;
			color: #777;
		}
		.box {
			margin-left: 25px;
			margin-top: 25px;
		}
		.figureLeftExplorer {
			float: left;
			width: 250px;
			height: 600px;
			text-align: center;
			font-size: medium;
			font-family: "Helvetica Neue", Helvetica;
		}
		.figureRightExplorer {
			float: left;
			position: relative;
			text-align: center;
			width: 875px;
			height: 600px;
		}
		.figureLeftSpark {
			float: left;
			position: relative;
			text-align: center;
			width: 875px;
			height: 600px;
		}
		.figureRightSpark {
			float: left;
			width: 250px;
			height: 600px;
			text-align: center;
			font-size: medium;
			font-family: "Helvetica Neue", "Helvetica";
		}
		.text-button, #yearField, #monthField, #dayField { font-size: 13px; }
		.myButton {
			background-color:#ffffff;
			-moz-border-radius:7px;
			-webkit-border-radius:7px;
			border-radius:7px;
			border:1px solid #dcdcdc;
			display:inline-block;
			cursor:pointer;
			color:#666666;
			font-family:Arial;
			font-size:13px;
			font-weight:bold;
			padding:2px 20px;
			margin: 0px 10px 0px 10px;
			text-decoration:none;
		}
		.myButton:hover {
			background-color:#f6f6f6;
		}
		.myButton:active {
			position:relative;
			top:1px;
		}
		.leftArrow { position: absolute; bottom: 0; left: 0; font-size: xx-large; margin: 10px; }
		.rightArrow { position: absolute; bottom: 0; right: 0; font-size: xx-large; margin: 10px; }
		.fileName { position: absolute; bottom: 0; width: 100%; text-align: center; font-size: medium; margin: 10px; }
		//.pink { background: #6cf; }
		.pink { background: #eee; }
		.green { background: #cff; }
		.blue { background: #cff; }
		.white { background: #fff; }
		.pysparkButton { position: absolute; bottom: 0; width: 100%; text-align: center; font-size: large; margin: 10px; }
		#pysparkResults { }
	
		.footer { height: 10px; text-align: center; font-size: small; }
		
		.advanced {
			position: fixed;
			bottom: 0;
			right: 0;
			padding: 10px;
			color: #a0a0a0;
		}			
		path {
		  stroke: #fff;
		}

		path:first-child {
		  fill: yellow !important;
		}

		circle {
		  fill: #000;
		  pointer-events: none;
		}

		.q0-9 { fill: rgb(197,27,125); }
		.q1-9 { fill: rgb(222,119,174); }
		.q2-9 { fill: rgb(241,182,218); }
		.q3-9 { fill: rgb(253,224,239); }
		.q4-9 { fill: rgb(247,247,247); }
		.q5-9 { fill: rgb(230,245,208); }
		.q6-9 { fill: rgb(184,225,134); }
		.q7-9 { fill: rgb(127,188,65); }
		.q8-9 { fill: rgb(77,146,33); }

	</style>
		<!-- this script will listen for button push and then execute cgi script and return data to user -->
	<script type="text/javascript">
		function onTest( dest, params ){
			var xmlhttp;
			if( window.XMLHttpRequest ){ // code for IE7+, Firefox, Chrome, Opera, Safari
			    xmlhttp=new XMLHttpRequest();
			} else { // code for IE6, IE5
			    xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
			}

			xmlhttp.onreadystatechange=function(){
			    if (xmlhttp.readyState==4 && xmlhttp.status==200){
				document.getElementById( "pysparkResults" ).innerHTML = xmlhttp.responseText;
			    }
			}
			xmlhttp.open("POST",dest,true);
			xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
			xmlhttp.send( params ); 
		}
	</script>

	</head>
	<body>	
	<div id="wrapper">
		<div class="header">Snow and Ice Data
			<div class="subtitle">
				<a href="http://nsidc.org/data/docs/daac/nsidc0001_ssmi_tbs.gd.html">DMSP SSM/I-SSMIS daily polar gridded brightness temperatures</a>
			</div><!--end subtitle-->
		</div><!--end header-->
<!-- menu -->	
		<div class="menu">
			<span id="dataExplorer">data-explorer </span>/<span id="sparkInterface"> spark-interface</span>
		</div>
<!-- top box -->
		<div class="block pink">
			<div class="box figureLeftExplorer white">
				<br><br><br><br><span>region</span><br>                
				<span id="north" class="text-button" id="northSouth" onclick="changeRegion('n')">[ north ↑ ] </span>
				<span id="south" class="text-button" id="northSouth" onclick="changeRegion('s')">[ south ↓ ]</span>
				
				<br><br><br><span>frequency</span><br>
				<span id="91" class="text-button" id="frequencyChoice" onclick="changeFreq(91)">[ 91.7 ] </span>
				<span id="85" class="text-button" id="frequencyChoice" onclick="changeFreq(85)">[ 85.5 ] </span>
				<span id="37" class="text-button" id="frequencyChoice" onclick="changeFreq(37)">[ 37.0 ] </span>
				<span id="22" class="text-button" id="frequencyChoice" onclick="changeFreq(22)">[ 22.2 ] </span>
				<span id="19" class="text-button" id="frequencyChoice" onclick="changeFreq(19)">[ 19.3 ]</span>
				
				<br><br><br><span>polarization</span><br>
				<span id="vertical" class="text-button" onclick="changePolarization('v')">[ vertical ↕ ] </span>
				<span id="horizontal" class="text-button" onclick="changePolarization('h')">[ horizontal ↔ ]</span>
				
				<br><br><br><span>year</span><br>
				<span onClick="decrementYear()"> ← </span>
				<span id="yearField"></span>
				<span onClick="incrementYear()"> → </span>
				
				<br><br><br><span>month</span><br>
				<span onClick="decrementMonth()"> ← </span>
				<span id="monthField"></span>
				<span onClick="incrementMonth()"> → </span>
				
				<br><br><br><span>day</span><br>
				<span onClick="decrementDay()"> ← </span>
				<span id="dayField"></span>
				<span onClick="incrementDay()"> → </span>
			</div><!--end left-->
			
			<div class="box figureRightExplorer white">
				<div id="outputInfo">
					<div id="outputImageTemperature">brightness temperature:</div>
					<div id="outputImageCoordinates">location:</div>
					<div id="outputImageMin">min: </div>
					<div id="outputImageMax">max: </div>
				</div>
				<br>
				<canvas id="myCanvas" width="600" height="500">Canvas</canvas>
				<div class="fileName" id="fileLabelName"><center></center></div>
				<div class="leftArrow" onclick="decrement()">←</div>
				<div class="rightArrow" onclick="increment()">→</div>
			</div><!--end center-->
		</div>
		
		<div class="block green">
			<div class="box figureLeftSpark white">
				python results generated each time button is pressed...
        			<div id="pysparkResults"><p id="pyspark">python</p></div>


			        <div class="pysparkButton"><a href="javascript:onTest('/cgi-bin/test.py', '')">run pyspark</a></div>
			</div><!--end center-->
			
			<div class="box figureRightSpark white">
				<br><br><br><br>
				dataset
				<br>
				[ seaice ] [ ssmi ]
				<br><br>
				evaluation method
				<br><br>
				[ temporal ]<br>
				start: year | month | day<br>
				end: year | month | day<br>
				<br><br>
				[ spatial ]
				row: start | end
				column: start | end
				<br>
				[ combo ]
				<br><br>

			</div><!--end right-->
		</div><!--end boxMiddle-->
		
		<div class="block footer">
			<p id="copyright">Copyright &#169
				<script type="text/javascript">
				<!--
				var currentTime = new Date()
				var year = currentTime.getFullYear()
				document.write(year)
				//-->
				</script>, by The Snow and Ice Data Center</p>
		</div><!--end footer-->
		
		<div class="advanced"><a onmouseover="this.innerHTML='advanced'" onmouseout="this.innerHTML='π'" href="http://104.154.87.138">π</a></div>
	</div><!--end wrapper-->
		
	<!-- decrement increment the image on canvas -->
	<script type="text/javascript">
		directory = "data/south/";
		region = "s";
		frequency = "91";
		polarization = "h";
		year = 2009; month = 10; day = 1;
		minimumTemperature = 50; maximumTemperature = 350;
		monthArray = ['jan','feb','mar','apr','may','jun','jul','aug','sep','oct','nov','dec'];
		date = new Date();
		date.setFullYear(year, month, day); // year, month (0-based), day
		//date.setTime(date.getTime() + (86400*100));
		currentFileName = "data/south/2010/tb_f17_20090310_v4_s91h.bin";
		function decrement(){ // sub one from day
			date.setTime(date.getTime() - 86400000); updateImage();
		}
		function increment(){ // add one to the day
			date.setTime(date.getTime() + 86400000); updateImage();
		}
		function changeFreq(num){ frequency = num; updateImage(); }
		function changeRegion(reg) { region = reg; updateImage(); }
		function changePolarization(pol) { polarization = pol; updateImage(); }
		function updateDateFields(){
			document.getElementById("yearField").innerHTML = year;
			document.getElementById("monthField").innerHTML = monthArray[month];
			document.getElementById("dayField").innerHTML = day;
		}
		function updateImage(){
			console.log("currentFileName: ", currentFileName);
			dateString = date.getFullYear().toString()+('0'+(date.getMonth()+1)).slice(-2)+('0'+date.getDate()).slice(-2);
			year = date.getFullYear();
			month = date.getMonth();
			day = date.getDate();
			updateDateFields();
			currentFileName = directory + year + "/tb_f17_" + dateString + "_v4_" + region + frequency + polarization + ".bin";
			console.log("updatedFileName: ", currentFileName);
			document.getElementById( "fileLabelName" ).innerHTML = currentFileName;
			
			var xhr = new XMLHttpRequest();
			xhr.open('GET', currentFileName, true);
			xhr.responseType = 'arraybuffer';

			xhr.onload = function(e){
				console.log("response: ", this.response);
				var responseArray = new Uint16Array(this.response);
				console.log("response array: ", responseArray);
				
				var c = document.getElementById("myCanvas");
				var ctx = c.getContext("2d");
        			ctx.clearRect(0, 0, c.width, c.height);
				
				// get size of image
				if( responseArray.length == 419648 ){ // south 664x632
					var imageHeight = 664; var imageWidth = 632;
				} else if( responseArray.length == 104912 ){ // south 332x316
					var imageHeight = 332; var imageWidth = 316;
				} else if( responseArray.length == 544768 ){ // north 896x608
					var imageHeght = 896; var imageWidth = 608;
				} else if( responseArray.length == 136192 ){ // north 448x304
					var imageHeight = 448; var imageWidth = 304;
				} else { // error of some sort
					document.getElementById( "fileLabelName" ).innerHTML = "No Files Available For These Parameters!";
					return;
				}
				
				var imgData = ctx.createImageData(imageWidth, imageHeight);
				for( var i = 0, j = 0; i < imgData.data.length; i+=4, j++ ){
					if( responseArray[j] == 0 ){ // missing data
						imgData.data[i+0] = 0;
						imgData.data[i+1] = 0;
						imgData.data[i+2] = 0;
						imgData.data[i+3] = 0;
					} else {
						imgData.data[i+0] = (responseArray[j]/10-50)/300*255;
						imgData.data[i+1] = (responseArray[j]/10-50)/300*255;
						imgData.data[i+2] = (responseArray[j]/10-50)/300*255;
						imgData.data[i+3] = 255;
					}
				}
				// update max min
				minimumTemperature = Math.min.apply(null, responseArray);
				maximumTemperature = Math.max.apply(null, responseArray);
				document.getElementById("outputImageMin").innerHTML = "min: " + minimumTemperature/10;
				document.getElementById("outputImageMax").innerHTML = "max: " + maximumTemperature/10;
				ctx.putImageData(imgData,(600-imageWidth)/2,(500-imageWidth)/2);
			};
			xhr.send();
		}
		updateImage();

		// find pos and append to the plot
		function findPos( obj ){
			var current_left = 0, current_top = 0;
			if (obj.offsetParent){
				do{
					current_left += obj.offsetLeft;
					current_top += obj.offsetTop;
				} while( obj = obj.offsetParent );
				return {x: current_left, y: current_top};
			}
			return undefined;
		}
		function rgbToHex(r, g, b){
			if (r > 255 || g > 255 || b > 255)
				throw "Invalid color component";
			return ((r << 16) | (g << 8) | b).toString(16);
		}
		// output pixel info to screen
		$('#myCanvas').mousemove(function(e){
			var position = findPos(this);
			var x = e.pageX - position.x;
			var y = e.pageY - position.y;
			var coordinate = "location: x = " + x + ", y = " + y;
			var canvas = this.getContext('2d');
			var p = canvas.getImageData(x, y, 1, 1).data;
			//var hex = "#" + ("000000" + rgbToHex(p[0], p[1], p[2])).slice(-6);
			var temperature = Math.round( p[0]/255*300+50 );
			if( temperature == 50 ){
				document.getElementById("outputImageTemperature").innerHTML = "brightness temperature: ";
			} else {
				document.getElementById("outputImageTemperature").innerHTML = "brightness temperature: " + temperature + " K";
			}
			document.getElementById("outputImageCoordinates").innerHTML = coordinate.toString();
			//alert("HEX: " + hex);
		});
		$('#myCanvas').mouseout(function(e){
			document.getElementById( "outputImageTemperature" ).innerHTML = "brightness temperature: ";
			document.getElementById( "outputImageCoordinates" ).innerHTML = "location:";
		});
	</script>

	<!-- increment value of button -->
	<script type="text/javascript">
		window.onload = function(){
			document.getElementById("yearField").innerHTML = year;
			document.getElementById("monthField").innerHTML = month;
			document.getElementById("dayField").innerHTML = day;
		}
		function incrementYear(){
			if( (year) < 2015 ){
				date.setFullYear(year+1, month, day); // year, month (0-based), day
			}
			updateImage();
		}
		function decrementYear(){
			if( (year) > 1987 ){
				date.setFullYear(year-1, month, day); // year, month (0-based), day
			}
			updateImage();
		}
		function incrementMonth(){
			date.setFullYear(year, (month+1), day); // year, month (0-based), day
			updateImage();
		}
		function decrementMonth(){
			date.setFullYear(year, (month-1), day); // year, month (0-based), day
			updateImage();
		}
		function incrementDay(){
			date.setFullYear(year, month, day+1); // year, month (0-based), day
			updateImage();
		}
		function decrementDay(){
			date.setFullYear(year, month, day-1); // year, month (0-based), day
			updateImage();
		}
		
	</script>

	</body>
</html>
